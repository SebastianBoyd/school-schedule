var redwood = [
  {
    "periods": [
      {
        "name": "1st",
        "end": 525
      },
      {
        "name": "2nd",
        "end": 575
      },
      {
        "name": "Break",
        "end": 585
      },
      {
        "name": "3rd",
        "end": 635
      },
      {
        "name": "Advisory",
        "end": 680
      },
      {
        "name": "4th",
        "end": 730
      },
      {
        "name": "Lunch",
        "end": 765
      },
      {
        "name": "5th",
        "end": 815
      },
      {
        "name": "6th",
        "end": 865
      },
      {
        "name": "7th",
        "end": 915
      },
      {
        "name": "Freedom",
        "end": 920
      }
    ]
  },
  {
    "periods": [
      {
        "name": "1st",
        "end": 480
      },
      {
        "name": "2nd",
        "end": 535
      },
      {
        "name": "Break",
        "end": 585
      },
      {
        "name": "3rd",
        "end": 600
      },
      {
        "name": "4th",
        "end": 655
      },
      {
        "name": "Lunch",
        "end": 705
      },
      {
        "name": "5th",
        "end": 750
      },
      {
        "name": "6th",
        "end": 805
      },
      {
        "name": "7th",
        "end": 860
      },
      {
        "name": "Freedom",
        "end": 910
      }
    ]
  },
  {
    "periods": [
      {
        "name": "4th",
        "end": 480
      },
      {
        "name": "Break",
        "end": 570
      },
      {
        "name": "5th",
        "end": 585
      },
      {
        "name": "Lunch",
        "end": 675
      },
      {
        "name": "6th",
        "end": 715
      },
      {
        "name": "Break",
        "end": 805
      },
      {
        "name": "7th",
        "end": 820
      },
      {
        "name": "Freedom",
        "end": 910
      }
    ]
  },
  {
    "periods": [
      {
        "name": "1st",
        "end": 480
      },
      {
        "name": "SMART",
        "end": 575
      },
      {
        "name": "Break",
        "end": 620
      },
      {
        "name": "2nd",
        "end": 635
      },
      {
        "name": "Lunch",
        "end": 725
      },
      {
        "name": "3rd",
        "end": 775
      },
      {
        "name": "Faculty Meeting",
        "end": 875
      },
      {
        "name": "End",
        "end": 930
      }
    ]
  },
  {
    "periods": [
      {
        "name": "1st",
        "end": 480
      },
      {
        "name": "2nd",
        "end": 535
      },
      {
        "name": "Break",
        "end": 585
      },
      {
        "name": "3rd",
        "end": 600
      },
      {
        "name": "4th",
        "end": 655
      },
      {
        "name": "Lunch",
        "end": 705
      },
      {
        "name": "5th",
        "end": 750
      },
      {
        "name": "6th",
        "end": 805
      },
      {
        "name": "7th",
        "end": 860
      },
      {
        "name": "End",
        "end": 910
      }
    ]
  }
];

var drake = [
    {
        "periods": [
            {
                "name": "1st",
                "end": 528
            },
            {
                "name": "2nd",
                "end": 581
            },
            {
                "name": "Break",
                "end": 596
            },
            {
                "name": "3rd",
                "end": 649
            },
            {
                "name": "Advisory",
                "end": 668
            },
            {
                "name": "4th",
                "end": 721
            },
            {
                "name": "Lunch",
                "end": 761
            },
            {
                "name": "5th",
                "end": 814
            },
            {
                "name": "6th",
                "end": 867
            },
            {
                "name": "7th",
                "end": 920
            },
            {
                "name": "Freedom",
                "end": 920
            }
        ]
    },
    {
        "periods": [
            {
                "name": "1st",
                "end": 570
            },
            {
                "name": "Break",
                "end": 580
            },
            {
                "name": "2nd",
                "end": 680
            },
            {
                "name": "Lunch",
                "end": 720
            },
            {
                "name": "5th",
                "end": 815
            },
            {
                "name": "Break",
                "end": 825
            },
            {
                "name": "7th",
                "end": 920
            },
            {
                "name": "Freedom",
                "end": 920
            }
        ]
    },
    {
        "periods": [
            {
                "name": "3rd",
                "end": 570
            },
            {
                "name": "Break",
                "end": 585
            },
            {
                "name": "Advisory",
                "end": 600
            },
            {
                "name": "Tutorial",
                "end": 650
            },
            {
                "name": "4th",
                "end": 745
            },
            {
                "name": "Lunch",
                "end": 785
            },
            {
                "name": "6th",
                "end": 880
            },
            {
                "name": "Freedom",
                "end": 880
            }
        ]
    },
    {
        "periods": [
            {
                "name": "1st",
                "end": 570
            },
            {
                "name": "Break",
                "end": 580
            },
            {
                "name": "2nd",
                "end": 680
            },
            {
                "name": "Lunch",
                "end": 720
            },
            {
                "name": "5th",
                "end": 815
            },
            {
                "name": "Break",
                "end": 825
            },
            {
                "name": "7th",
                "end": 920
            },
            {
                "name": "Freedom",
                "end": 920
            }
        ]
    },
    {
        "periods": [
            {
                "name": "3rd",
                "end": 570
            },
            {
                "name": "Break",
                "end": 585
            },
            {
                "name": "Advisory",
                "end": 600
            },
            {
                "name": "Tutorial",
                "end": 650
            },
            {
                "name": "4th",
                "end": 745
            },
            {
                "name": "Lunch",
                "end": 785
            },
            {
                "name": "6th",
                "end": 880
            },
            {
                "name": "Freedom",
                "end": 880
            }
        ]
    }
];

var schools = [drake, redwood];

//Create Variables
var currentPeriod = document.getElementById('period');
var timeLeft = document.getElementById('minutes');
var nextPeriod = document.getElementById('next');
var inSchoolPage = document.getElementById('in-school');
var outOfSchoolPage = document.getElementById('out-school');
var h1 = document.querySelectorAll('h1');
var h2 = document.querySelectorAll('h2');

var minutesLeft;
var currentSchedule;
var schoolSchedule;
var now;
var day;
var date;
var currentHour;
var currentMinute;

// Register Service Worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js', { scope: '/' })
  .then(function () {
    console.log('[SW] Registered');
  })
  .catch(err => {
    console.warn('Error', err);
  });
}

init();

function init() {
  if (window.location.hostname == 'drakeschedule.tk') {
    initSchool(0);
  } else if (window.location.hostname == 'redwoodschedule.tk') {
    initSchool(1);
  } else {
    initSchool(0);
  }
}

function styleColors(one, two) {
  for(var i = 0; i < h1.length; i++){
    h1[i].style.color = one;
  }
  for(var k = 0; k < h2.length; k++) {
    h2[k].style.color = two;
  }
}

function initSchool(school) {
  schoolSchedule = schools[school];
  if(school == 1){
    styleColors('#F44336', '#000');
  }else if(school == 0){
    styleColors('#4CAF50', '#000');
  }
  inSchoolPage.style.display = 'block';

  now = new Date();
  day = now.getDay();
  currentMinute = now.getMinutes();
  currentSchedule = schoolSchedule[day].periods;

  if (day == 6 || day == 0 || currentMinute > currentSchedule[currentSchedule.length - 2].end) {
    inSchoolPage.style.display = 'none';
    outOfSchoolPage.style.display = 'block';
  } else {
    updateInfo();
    window.setInterval(updateInfo, 500);
  }
}

//Define function that will update the info on screen based on the current schedule
function updateInfo() {
  now = new Date();
  currentHour = now.getHours();
  currentMinute = now.getMinutes();
  currentMinute = (currentHour * 60) + currentMinute;
  currentMinute = 678;
  for (var i = 0; i < currentSchedule.length; i++) {
    //If the current time is beyond the end of the current schedule, and less then the end of the next class
    if (currentMinute > currentSchedule[i].end && currentMinute < currentSchedule[i + 1].end) {
      //Then the current period is the index, i + 1
      currentPeriod.textContent = currentSchedule[i + 1].name;
      //We define left as time left in period by subtracting the current time from the end time
      minutesLeft = currentSchedule[i + 1].end - currentMinute;
      //If the amount of time (in minutes) is greater than 60, display time in hours and mintutes
      if (minutesLeft > 60) {
        //Call function to calculate time left
        timeLeft.textContent = minutesToHours(minutesLeft).hours + ' hour and ' + minutesToHours(minutesLeft).minutes + ' minutes';
        //OTHERWISE, just display minutes left
      } else {
        timeLeft.textContent = minutesLeft + ' minutes';
      }
      //Define next period and i + 2, because the current one is i + 1
      nextPeriod.textContent = currentSchedule[i + 2].name;
      //OTHERWISE, if it is first period
    } else if (currentMinute >= 480 && currentMinute < currentSchedule[0].end) {
      //Define next period
      nextPeriod.textContent = currentSchedule[i].name;
      minutesLeft = currentSchedule[i].end - currentMinute;
      if (minutesLeft > 60) {
        //Call function to calculate time left
        timeLeft.textContent = minutesToHours(minutesLeft).hours + ' hour and ' + minutesToHours(minutesLeft).minutes + ' minutes';
        //OTHERWISE, just display minutes left
      } else {
        timeLeft.textContent = minutesLeft + ' minutes';
      }
      currentPeriod.textContent = currentSchedule[i + 1].name;
      return;
    }
  }
}

///Define function that returns hours and minutes from minutes
function minutesToHours(timeLeft) {
  return {
        hours: Math.round(timeLeft / 60),
        minutes: timeLeft % 60
    };
}
