var redwood = [
  {
    "periods": [
      {
        "name": "1st",
        "end": 525
      },
      {
        "name": "2nd",
        "end": 575
      },
      {
        "name": "Break",
        "end": 585
      },
      {
        "name": "3rd",
        "end": 635
      },
      {
        "name": "Advisory",
        "end": 680
      },
      {
        "name": "4th",
        "end": 730
      },
      {
        "name": "Lunch",
        "end": 765
      },
      {
        "name": "5th",
        "end": 815
      },
      {
        "name": "6th",
        "end": 865
      },
      {
        "name": "7th",
        "end": 915
      },
      {
        "name": "Freedom",
        "end": 920
      }
    ]
  },
  {
    "periods": [
      {
        "name": "1st",
        "end": 480
      },
      {
        "name": "2nd",
        "end": 535
      },
      {
        "name": "Break",
        "end": 585
      },
      {
        "name": "3rd",
        "end": 600
      },
      {
        "name": "4th",
        "end": 655
      },
      {
        "name": "Lunch",
        "end": 705
      },
      {
        "name": "5th",
        "end": 750
      },
      {
        "name": "6th",
        "end": 805
      },
      {
        "name": "7th",
        "end": 860
      },
      {
        "name": "Freedom",
        "end": 910
      }
    ]
  },
  {
    "periods": [
      {
        "name": "4th",
        "end": 480
      },
      {
        "name": "Break",
        "end": 570
      },
      {
        "name": "5th",
        "end": 585
      },
      {
        "name": "Lunch",
        "end": 675
      },
      {
        "name": "6th",
        "end": 715
      },
      {
        "name": "Break",
        "end": 805
      },
      {
        "name": "7th",
        "end": 820
      },
      {
        "name": "Freedom",
        "end": 910
      }
    ]
  },
  {
    "periods": [
      {
        "name": "1st",
        "end": 480
      },
      {
        "name": "SMART",
        "end": 575
      },
      {
        "name": "Break",
        "end": 620
      },
      {
        "name": "2nd",
        "end": 635
      },
      {
        "name": "Lunch",
        "end": 725
      },
      {
        "name": "3rd",
        "end": 775
      },
      {
        "name": "Faculty Meeting",
        "end": 875
      },
      {
        "name": "End",
        "end": 930
      }
    ]
  },
  {
    "periods": [
      {
        "name": "1st",
        "end": 480
      },
      {
        "name": "2nd",
        "end": 535
      },
      {
        "name": "Break",
        "end": 585
      },
      {
        "name": "3rd",
        "end": 600
      },
      {
        "name": "4th",
        "end": 655
      },
      {
        "name": "Lunch",
        "end": 705
      },
      {
        "name": "5th",
        "end": 750
      },
      {
        "name": "6th",
        "end": 805
      },
      {
        "name": "7th",
        "end": 860
      },
      {
        "name": "End",
        "end": 910
      }
    ]
  }
];

var drake = [
    {
        "periods": [
            {
                "name": "1st",
                "end": 528
            },
            {
                "name": "2nd",
                "end": 581
            },
            {
                "name": "Break",
                "end": 596
            },
            {
                "name": "3rd",
                "end": 649
            },
            {
                "name": "Advisory",
                "end": 668
            },
            {
                "name": "4th",
                "end": 721
            },
            {
                "name": "Lunch",
                "end": 761
            },
            {
                "name": "5th",
                "end": 814
            },
            {
                "name": "6th",
                "end": 867
            },
            {
                "name": "7th",
                "end": 920
            },
            {
                "name": "Freedom",
                "end": 920
            }
        ]
    },
    {
        "periods": [
            {
                "name": "1st",
                "end": 570
            },
            {
                "name": "Break",
                "end": 580
            },
            {
                "name": "2nd",
                "end": 680
            },
            {
                "name": "Lunch",
                "end": 720
            },
            {
                "name": "5th",
                "end": 815
            },
            {
                "name": "Break",
                "end": 825
            },
            {
                "name": "7th",
                "end": 920
            },
            {
                "name": "Freedom",
                "end": 920
            }
        ]
    },
    {
        "periods": [
            {
                "name": "3rd",
                "end": 570
            },
            {
                "name": "Break",
                "end": 585
            },
            {
                "name": "Advisory",
                "end": 600
            },
            {
                "name": "Tutorial",
                "end": 650
            },
            {
                "name": "4th",
                "end": 745
            },
            {
                "name": "Lunch",
                "end": 785
            },
            {
                "name": "6th",
                "end": 880
            },
            {
                "name": "Freedom",
                "end": 880
            }
        ]
    },
    {
        "periods": [
            {
                "name": "1st",
                "end": 570
            },
            {
                "name": "Break",
                "end": 580
            },
            {
                "name": "2nd",
                "end": 680
            },
            {
                "name": "Lunch",
                "end": 720
            },
            {
                "name": "5th",
                "end": 815
            },
            {
                "name": "Break",
                "end": 825
            },
            {
                "name": "7th",
                "end": 920
            },
            {
                "name": "Freedom",
                "end": 920
            }
        ]
    },
    {
        "periods": [
            {
                "name": "3rd",
                "end": 570
            },
            {
                "name": "Break",
                "end": 585
            },
            {
                "name": "Advisory",
                "end": 600
            },
            {
                "name": "Tutorial",
                "end": 650
            },
            {
                "name": "4th",
                "end": 745
            },
            {
                "name": "Lunch",
                "end": 785
            },
            {
                "name": "6th",
                "end": 880
            },
            {
                "name": "Freedom",
                "end": 880
            }
        ]
    }
];

var schools = [drake, redwood];

//Create Variables
var period = document.getElementById('period');
var minutes = document.getElementById('minutes');
var next = document.getElementById('next');
var inSchool = document.getElementById('in-school');
var outSchool = document.getElementById('out-school');
var h1 = document.querySelectorAll('h1');
var h2 = document.querySelectorAll('h2');
var currentSchedule;

//Register Service Worker
// if ('serviceWorker' in navigator) {
//   navigator.serviceWorker.register('./sw.js', { scope: '/' })
//   .then(function () {
//     console.log('[SW] Registered');
//   })
//   .catch(err => {
//     console.warn('Error', err);
//   });
// }


inSchool.style.display = 'none';
outSchool.style.display = 'none';
console.log('init');
init();

function init() {
  if (window.location.hostname == 'drakeschedule.tk') {
    console.log('drake');
    initSchool(0);
  }
  else if (window.location.hostname == 'redwoodschedule.tk') {
    console.log('redwood');
    initSchool(1);
  }
  else {
    console.log('other');
    initSchool(0);
  }

}

function styleColors(one, two) {
  for(var i = 0; i < h1.length; i++){
    h1[i].style.color = one;
  }
  for(var k = 0; k < h2.length; k++) {
    h2[k].style.color = two;
  }
}

function initSchool(school) {
  schoolSchedule = schools[school];
  if(school == 1){
    console.log('yep');
    styleColors('#F44336', '#000');
  }else if(school == 0){
    styleColors('#4CAF50', '#000');
  }
  inSchool.style.display = 'block';

  var now = new Date();
  var day = now.getDay();
  var date = now.getDate();
  var min = now.getMinutes();
  var hour = now.getHours();
  min = (hour * 60) + min;
  currentSchedule = schoolSchedule[day].periods;

  if (day == 6 || day == 0 || min > currentSchedule[currentSchedule.length - 2].end) {
    inSchool.style.display = 'none';
    outSchool.style.display = 'block';
  } else {
    updateInfo();
    window.setInterval(updateInfo, 500);
  }
}


function updateInfo() {
  now = new Date();
  hour = now.getHours();
  min = now.getMinutes();
  min = (hour * 60) + min;
  for (var i = 0; i < currentSchedule.length; i++) {
    if(min > currentSchedule[i].end && min < currentSchedule[i + 1].end) {
      period.textContent = currentSchedule[i + 1].name;
      var left = currentSchedule[i + 1].end - min;
      if(left > 60) {
        var hours = Math.round(left / 60);
        left = left % 60;
        minutes.textContent = hours + 'hour and ' + left + ' minutes';
      }else {
        minutes.textContent = left + ' minutes';
      }
      next.textContent = currentSchedule[i + 2].name;
    }else if(min >= 480 && min < currentSchedule[0].end){
      period.textContent = currentSchedule[i].name;
      var left = currentSchedule[i].end - min;
      if(left > 60) {
        var hours = Math.round(left / 60);
        left = left % 60;
        minutes.textContent = hours + 'hour and' + left + ' minutes';
      }else {
        minutes.textContent = left + ' minutes';
      }
      next.textContent = currentSchedule[i + 1].name;
      return;
    }
  }
}
